"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){(0,_defineProperty2.default)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var Download=function(){function t(e){return(0,_classCallCheck2.default)(this,t),"string"==typeof e&&(e=Object.assign({},{url:arguments[0]},arguments[1])),this.$options=e,this.fetchFile()}var r;return(0,_createClass2.default)(t,[{key:"saveAs",value:(r=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t,r){var n,a;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t instanceof Blob?t:new Blob(t),(a=document.createElement("a")).download=r,a.href=URL.createObjectURL(n),e.next=6,a.dispatchEvent(new MouseEvent("click"));case 6:return e.next=8,URL.revokeObjectURL(a.href);case 8:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)})},{key:"fetchFile",value:function(){var i=this,e=this.$options,t=e.url,r=e.filename,c=void 0===r?null:r,r=e.getProgress,l=void 0===r?null:r,e=(0,_objectWithoutProperties2.default)(e,["url","filename","getProgress"]);return fetch(t,_objectSpread({mode:"cors",credentials:"same-origin"},e)).then(function(e){return e.ok?(c=c||decodeURI(e.headers.get("Content-Disposition").split("filename=")[1]),e):Promise.reject({status:e.status,statusText:e.statusText})}).then(function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t){var r,n;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof l)return e.t0=i,e.next=4,t.blob();e.next=10;break;case 4:return e.t1=e.sent,e.t2=c,e.t0.saveAs.call(e.t0,e.t1,e.t2),e.abrupt("return",Promise.reject({status:200,statusText:"No need to get download progress."}));case 10:if(0===(r=t.headers.get("Content-Length")||0))return e.abrupt("return",Promise.reject({status:400,statusText:"Missing file size for Content-Length field."}));e.next=13;break;case 13:return n=t.body.getReader(),e.abrupt("return",{totalSize:r,reader:n});case 15:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()).then(function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t){var r,n,a,o,s,u;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.totalSize,n=t.reader,a=0,o=[];case 2:return e.next=5,n.read();case 5:if(u=e.sent,s=u.done,u=u.value,s){e.next=14;break}o.push(u),a+=u.length,l(Number((a/r*100).toFixed(2))),e.next=15;break;case 14:return e.abrupt("break",17);case 15:e.next=2;break;case 17:i.saveAs(o,c);case 18:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}())}}]),t}(),_default=Download;exports.default=Download;